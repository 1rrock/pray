# 기능 명세서: 음성 및 텍스트 입력 기반 AI 기도 응답

**기능 브랜치**: `001-ai-prayer-response`  
**작성일**: 2025년 11월 26일  
**상태**: 초안  
**입력**: 사용자 설명: "stt기능 사용해서 유저가 text, voice로 기도를 입력하면 ai사용해서 성경 구절 + 말씀 답해주는 앱"

## 사용자 시나리오 및 테스팅 *(필수)*

### 사용자 스토리 1 - AI 응답을 포함한 텍스트 기도 입력 (우선순위: P1)

사용자는 앱에 직접 기도문을 입력하고, 관련 성경 구절과 영적 지도가 포함된 AI 생성 응답을 받을 수 있습니다. 이는 사용자가 글로 작성한 기도를 통해 영적 위로와 성경적 지혜를 구할 수 있게 하는 핵심 상호작용입니다.

**이 우선순위인 이유**: 이것은 앱의 근본적인 가치 제안입니다. 텍스트 입력은 (음성과 달리) 특별한 권한이 필요 없고, 어떤 환경(조용하거나 시끄러운)에서도 작동하며, 음성 입력이 구축되는 기반 기능 역할을 합니다. 사용자는 기술적 장벽 없이 즉시 핵심 기능을 경험할 수 있습니다.

**독립 테스트**: 기도 요청을 입력하고 제출한 후, 시스템이 문맥상 관련성 있는 성경 구절과 격려 메시지를 반환하는지 확인하여 완전히 테스트할 수 있습니다. 텍스트 상호작용만으로 즉각적인 영적 지원을 제공합니다.

**수락 시나리오**:

1. **주어진 조건**: 사용자가 앱을 열었을 때, **행동**: 텍스트 입력 필드에 기도문을 입력하고 제출하면, **예상 결과**: 시스템이 관련 성경 구절과 기도 내용을 다루는 개인화된 영적 메시지를 표시함
2. **주어진 조건**: 사용자가 기도를 제출했을 때, **행동**: AI 응답이 생성되는 동안, **예상 결과**: 사용자는 기도가 처리되고 있음을 나타내는 로딩 표시를 봄
3. **주어진 조건**: 사용자가 AI 응답을 받았을 때, **행동**: 응답을 볼 때, **예상 결과**: 성경 구절 참조(책, 장, 절)와 전체 구절 텍스트 및 지도 메시지를 모두 볼 수 있음

---

### 사용자 스토리 2 - 음성 인식 기반 음성 기도 입력 (우선순위: P2)

사용자는 음성 입력을 사용하여 기도를 소리 내어 말할 수 있으며, 앱은 음성을 텍스트로 변환한 후 AI 응답을 생성합니다. 이는 특히 타이핑보다 말하기를 선호하거나 접근성이 필요한 사용자에게 유용한, 더 자연스럽고 핸즈프리 방식의 기도 방법을 제공합니다.

**이 우선순위인 이유**: 음성 입력은 기도에 더 자연스럽게 느껴지는 대체 입력 방법을 제공하여 사용자 경험을 향상시킵니다. 추가 권한과 더 복잡한 오류 처리가 필요하지만, P1 텍스트 입력 기반 위에 직접 구축됩니다. 텍스트 기도가 작동하면, 음성은 동일한 처리 파이프라인에 대한 다른 입력 방법이 됩니다.

**독립 테스트**: 마이크 권한을 부여하고, 음성 입력 버튼을 누르고, 기도를 말한 후, 음성이 정확하게 텍스트로 변환되고 텍스트 기도와 동일하게 처리되는지 확인하여 완전히 테스트할 수 있습니다. 핸즈프리 기도 입력 기능을 제공합니다.

**수락 시나리오**:

1. **주어진 조건**: 사용자가 처음 앱을 열었을 때, **행동**: 음성 입력 버튼을 누르면, **예상 결과**: 시스템이 필요한 이유에 대한 명확한 설명과 함께 마이크 권한을 요청함
2. **주어진 조건**: 마이크 권한이 부여되었을 때, **행동**: 사용자가 기도를 말하면서 음성 입력 버튼을 누르고 있으면, **예상 결과**: 시스템이 실시간으로 변환된 텍스트를 캡처하고 표시함
3. **주어진 조건**: 사용자가 기도 말하기를 완료했을 때, **행동**: 음성 입력 버튼을 놓으면, **예상 결과**: 변환된 기도 텍스트가 자동으로 AI 처리를 위해 제출됨
4. **주어진 조건**: 음성 인식이 활성화되었을 때, **행동**: 사용자가 명확하게 말하면, **예상 결과**: 변환이 명확한 음성에 대해 최소 90% 정확도로 단어를 정확하게 캡처함

---

### 사용자 스토리 3 - 기도 이력 및 과거 응답 (우선순위: P3)

사용자는 이전 기도와 받은 AI 응답을 볼 수 있어, 시간이 지남에 따라 자신의 영적 여정을 되돌아보고 받은 의미 있는 지도를 다시 방문할 수 있습니다.

**이 우선순위인 이유**: 이력은 장기적인 가치를 제공하고 지속적인 앱 사용을 장려하지만, 핵심 기도-응답 상호작용에는 필요하지 않습니다. 사용자는 이력 없이도 P1과 P2에서 즉각적인 이점을 얻을 수 있습니다. 이 기능은 유지율을 향상시키지만 초기 사용자 가치를 차단하지 않습니다.

**독립 테스트**: 시간이 지남에 따라 여러 기도를 제출하고, 이력 섹션으로 이동한 후, 모든 과거 기도와 응답이 타임스탬프와 함께 표시되는지 확인하여 완전히 테스트할 수 있습니다. 개인 영적 일지 기능을 제공합니다.

**수락 시나리오**:

1. **주어진 조건**: 사용자가 이전에 기도를 제출했을 때, **행동**: 기도 이력 섹션으로 이동하면, **예상 결과**: 타임스탬프가 있는 과거 기도의 시간순 목록을 봄
2. **주어진 조건**: 사용자가 기도 이력을 볼 때, **행동**: 특정 기도 항목을 선택하면, **예상 결과**: 원래 기도 텍스트 전체와 받은 AI 응답을 볼 수 있음
3. **주어진 조건**: 사용자가 기도 이력을 보고 있을 때, **행동**: 목록에 여러 항목이 포함되어 있으면, **예상 결과**: 가장 최근의 기도가 목록 맨 앞에 나타남

---

### 엣지 케이스

- 음성 입력이 배경 소음이나 불명확한 음성을 감지할 때 어떻게 되는가?
- 시스템이 일반적인 길이를 초과하는 매우 긴 기도(텍스트 또는 음성)를 처리하는 방법은?
- AI 서비스를 일시적으로 사용할 수 없거나 응답이 느릴 때 어떻게 되는가?
- 시스템이 여러 언어가 혼합되어 있거나 의도가 불명확한 기도를 처리하는 방법은?
- 사용자가 마이크 권한을 거부했지만 나중에 음성 입력을 사용하고 싶어할 때 어떻게 되는가?
- 시스템이 민감하거나 위기 관련 콘텐츠(예: 자해 표현)가 포함될 수 있는 기도에 어떻게 응답하는가?
- 기도 제출이나 AI 응답 생성 중에 네트워크 연결이 끊어질 때 어떻게 되는가?
- 시스템이 동일한 기도를 빠르게 반복 제출하는 것을 어떻게 처리하는가?

---

### 가정 *(선택)*

다음 가정들은 명세 작성 중 합리적인 기본값으로 설정되었습니다:

- **기도 길이 제한**: 텍스트 기도는 최대 500자, 음성 기도는 최대 2분으로 제한하여 짧고 집중된 기도를 장려하고 빠른 처리와 비용 효율성을 보장함
- **언어 지원**: 초기 출시는 한국어만 지원하며, 이는 더 빠른 개발과 집중된 사용자층을 가능하게 함. 향후 사용자 수요에 따라 추가 언어를 고려할 수 있음
- **위기 상황 처리**: 기본적인 키워드 기반 위기 감지를 구현하여 사용자 웰빙에 대한 관심을 보여주되, 침입적이지 않은 방식으로 자원을 제공함. 전문 상담 서비스의 대체가 아닌 보완적 역할을 함
- **데이터 보관**: 사용자의 기도 이력은 무기한 저장되며, 사용자가 언제든지 과거 기도와 응답을 검토할 수 있음
- **성경 구절 출처**: AI 응답에 사용되는 성경 구절은 신뢰할 수 있는 한국어 성경 번역본(예: 개역개정, 새번역 등)에서 선택됨

## 요구사항 *(필수)*

### 기능 요구사항

- **FR-001**: 시스템은 사용자로부터 텍스트 입력을 통한 기도 입력을 수락해야 함
- **FR-002**: 시스템은 음성-텍스트 변환을 통한 음성 녹음으로 기도 입력을 수락해야 함
- **FR-003**: 시스템은 음성 입력을 위해 마이크 권한을 적절하게 요청하고 처리해야 함
- **FR-004**: 시스템은 사용자가 기도를 말하는 동안 실시간 변환 피드백을 표시해야 함
- **FR-005**: 시스템은 (어느 입력 방법에서든) 기도 텍스트를 처리하고 문맥상 관련성 있는 응답을 생성해야 함
- **FR-006**: 시스템은 참조(책, 장, 절 번호)와 함께 최소 하나의 성경 구절을 포함하는 응답을 반환해야 함
- **FR-007**: 시스템은 기도 내용과 관련된 영적 지도 또는 격려를 포함하는 응답을 반환해야 함
- **FR-008**: 시스템은 AI 응답이 생성되는 동안 로딩 상태를 표시해야 함
- **FR-009**: 시스템은 나중에 검색할 수 있도록 타임스탬프와 함께 기도 이력을 저장해야 함
- **FR-010**: 시스템은 사용자가 과거 기도와 해당 AI 응답을 볼 수 있도록 허용해야 함
- **FR-011**: 시스템은 음성 입력 오류(배경 소음, 불명확한 음성 등)를 우아하게 처리해야 함
- **FR-012**: 시스템은 AI 서비스를 사용할 수 없을 때 명확한 오류 메시지를 제공해야 함
- **FR-013**: 시스템은 네트워크 연결 문제를 처리하고 사용자에게 적절하게 알려야 함
- **FR-014**: 시스템은 텍스트 기도의 경우 최대 500자, 음성 기도의 경우 최대 2분까지 지원해야 함
- **FR-015**: 사용자는 제출 전에 음성 녹음을 취소할 수 있어야 함
- **FR-016**: 시스템은 사용자가 제출 전에 변환된 음성 입력을 편집할 수 있도록 허용해야 함
- **FR-017**: 시스템은 초기 버전에서 한국어로 기도 입력과 응답을 지원해야 함 (추후 수요에 따라 다른 언어 추가 가능)
- **FR-018**: 시스템은 자해, 자살, 또는 심각한 위기 상황을 나타내는 키워드를 감지하고, 감지될 경우 일반 AI 응답과 함께 위기 상담 전화번호 및 전문 도움 자원 링크를 표시해야 함
- **FR-019**: 시스템은 위기 감지 시 오탐지를 최소화하기 위해 신중하게 설계되어야 하며, 사용자에게 부담을 주지 않는 방식으로 자원을 제공해야 함

### 주요 엔티티

- **기도(Prayer)**: 사용자의 기도 제출을 나타내며, 기도 텍스트 내용, 생성 타임스탬프, 입력 방법(텍스트 또는 음성), 선택적으로 사용자 식별자를 포함함
- **AI 응답(AI Response)**: 기도에 대한 시스템 생성 응답을 나타내며, 선택된 성경 구절(참조 및 전체 텍스트), 영적 지도 메시지, 타임스탬프, 해당 기도에 대한 링크를 포함함
- **기도 이력 항목(Prayer History Entry)**: 사용자 검토를 위해 기도와 AI 응답을 연결하는 이력 기록을 나타내며, 표시 순서 정보를 포함함

## 성공 기준 *(필수)*

### 측정 가능한 결과

- **SC-001**: 사용자는 정상 네트워크 조건에서 10초 이내에 (텍스트 또는 음성을 통해) 기도를 제출하고 AI 응답을 받을 수 있음
- **SC-002**: 음성 변환은 조용한 환경에서 명확한 음성에 대해 최소 90% 정확도를 달성함
- **SC-003**: 기도 제출의 95%가 최소 하나의 관련 성경 구절을 포함하는 AI 응답을 성공적으로 생성함
- **SC-004**: 사용자는 첫 사용 시 2분 이내에 전체 기도 제출 흐름(응답 받기 포함)을 완료할 수 있음
- **SC-005**: 앱은 성능 저하 없이 최소 100개의 동시 기도 제출을 처리함
- **SC-006**: 기도 이력은 100% 데이터 지속성으로 모든 과거 항목을 올바르게 표시함(기도 손실 없음)
- **SC-007**: 한 번의 기도를 제출한 사용자의 85%가 7일 이내에 다시 돌아와 다른 기도를 제출함(가치와 유지율을 나타냄)
- **SC-008**: 오류 상태(네트워크 실패, AI 사용 불가, 음성 인식 실패)가 명확한 실행 가능한 지침과 함께 3초 이내에 사용자에게 표시됨
- **SC-009**: 사용자는 5초 이내에 기도 이력에 액세스하고 과거 기도와 응답을 볼 수 있음
- **SC-010**: 음성 입력 권한 요청은 첫 번째 프롬프트에서 최소 70% 수락률을 가짐(명확한 가치 커뮤니케이션을 나타냄)
